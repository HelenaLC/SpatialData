---
title: "`Some SpatialData visualizations`"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
package: "`r BiocStyle::pkg_ver('SpatialData')`"
author:
  - name: Helena Lucia Crowell
  - name: Louise Deconinck
  - name: Art√ºr Manukyan
  - name: Dario Righelli
  - name: Estella Dong
  - name: Vince Carey
output:
  BiocStyle::html_document
vignette: |
  %\VignetteIndexEntry{Some SpatialData visualizations}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


# Introduction

In this vignette we explore how shape and point data in Xenium and
MERFISH experiments can be visualized.  We use examples that
can be retrieved from a Bioconductor bucket and cached in
BiocFileCache, using utilities in SpatialData package.

The xenium examples are:
```{r lkx, message=FALSE}
library(SpatialData)
available_10x_xen_zips()
```

[1] "Xenium_V1_human_Breast_2fov_outs.zip"
[2] "Xenium_V1_human_Lung_2fov_outs.zip"  


# Breast sample, "two fields of view"

## A view of "image data"

```{r getbr, message=FALSE}
pa <- path_to_10x_xen_demo("Xenium_V1_human_Breast_2fov_outs.zip")
dir.create(td <- tempfile())
unzip(pa, exdir=td)
# read & write to .zarr w/ 'spatialdata-io'
target <- tempfile()
nn = use_sdio("xenium", srcdir=td, dest=target) # returns NULL
# read into R
(br2fov <- readSpatialData(target))
plotSpatialData() + plotImage(br2fov)
```

## A view of the segmentation

```{r lkcb, message=FALSE}
library(ggplot2)
viewShape(br2fov, "cell_boundaries")
```

## Add points for a specific 'transcript'

```{r lkcb2, message=FALSE}
viewShape(br2fov, "cell_boundaries") + add_tx(br2fov, "EPCAM")
unlink(target, recursive=TRUE)
```

# Lung sample, "two fields of view"

## Image

```{r getlu, message=FALSE}
pa <- path_to_10x_xen_demo("Xenium_V1_human_Lung_2fov_outs.zip")
dir.create(td <- tempfile())
unzip(pa, exdir=td)
target <- tempfile()
nn = use_sdio("xenium", srcdir=td, dest=target) # returns NULL
(lu2fov <- readSpatialData(target))
plotSpatialData() + plotImage(lu2fov)
```

## Transcripts on segmentation

```{r lklu2, message=FALSE}
viewShape(lu2fov, "cell_boundaries") + add_tx(lu2fov, "EPCAM")
```

# MERFISH example

In this demo, we show how to take advantage of
size information in the shape data on cells.

```{r lkmerf}
tf = tempfile()
dir.create(tf)
pa = unzip_merfish_demo(tf)
pa
merf = readSpatialData(pa)
merfs = SpatialData:::.shapes2sf(merf, "cells")
ggplot(merfs) + geom_sf(colour="gray", size=merfs$radius/20)
```
